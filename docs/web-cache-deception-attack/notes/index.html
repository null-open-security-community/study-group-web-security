<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<title data-react-helmet="true">Notes | null Web Security Study Group</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://blog.null.community/study-group-web-security/docs/web-cache-deception-attack/notes"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Notes | null Web Security Study Group"><meta data-react-helmet="true" name="description" content="By Muffaddal Masalawala"><meta data-react-helmet="true" property="og:description" content="By Muffaddal Masalawala"><link data-react-helmet="true" rel="shortcut icon" href="/study-group-web-security/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://blog.null.community/study-group-web-security/docs/web-cache-deception-attack/notes"><link data-react-helmet="true" rel="alternate" href="https://blog.null.community/study-group-web-security/docs/web-cache-deception-attack/notes" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://blog.null.community/study-group-web-security/docs/web-cache-deception-attack/notes" hreflang="x-default"><link rel="stylesheet" href="/study-group-web-security/assets/css/styles.f4e51aac.css">
<link rel="preload" href="/study-group-web-security/assets/js/runtime~main.176889d2.js" as="script">
<link rel="preload" href="/study-group-web-security/assets/js/main.866a597b.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/study-group-web-security/"><b class="navbar__title">null Web Security Study Group</b></a><a class="navbar__item navbar__link navbar__link--active" href="/study-group-web-security/docs/intro">Documentation</a><a class="navbar__item navbar__link" href="/study-group-web-security/showcase">Showcase</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/null-open-security-community" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/study-group-web-security/docs/intro">Hey Folks!</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Access Control Issues</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Cross-Site Request Forgery</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">File Upload Vulnerabilities</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Web Cache Deception Attack</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/study-group-web-security/docs/web-cache-deception-attack/notes">Notes</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">XML External Entity</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Miscellaneous</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Contributors</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Contribute</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Notes</h1></header><p><em>By Muffaddal Masalawala</em></p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="normal-scenario">Normal Scenario<a aria-hidden="true" class="hash-link" href="#normal-scenario" title="Direct link to heading">â€‹</a></h2><ul><li>Website <a href="http://www.example.com" target="_blank" rel="noopener noreferrer">http://www.example.com</a> is configured to go through a reverse proxy.</li><li>A dynamic page (after authentication) that is stored on the server and returns personal content of users, such as <a href="http://www.example.com/home.php" target="_blank" rel="noopener noreferrer">http://www.example.com/home.php</a>, will have to create it dynamically per user, since the data is different for each user. This kind of data, or at least its personalized parts, isn&#x27;t cached.</li><li>What&#x27;s more reasonable and common to cache are static, public files: style sheets (css), scripts (js), text files (txt), images (png, bmp, gif), etc as these files usually don&#x27;t contain any sensitive information.</li></ul><p><img src="https://miro.medium.com/max/625/0*YVcUk4-Qv7lb06L1.jpg" alt="Reverse Proxy Working"></p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><ul><li>All static files that are meant to be public, are cached disregarding their HTTP caching headers.</li><li><strong>Various static file extensions could be used to cache pages</strong>: aif, aiff, au, avi, bin, bmp, cab, carb, cct, cdf, class, css, doc, dcr, dtd, gcf, gff, gif, grv, hdml, hqx, ico, ini, jpeg, jpg, js, mov, mp3, nc, pct, ppc, pws, swa, swf, txt, vbs, w32, wav, wbmp, wml, wmlc, wmls, wmlsc, xsd, zip</li></ul></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="attack-scenario">Attack Scenario<a aria-hidden="true" class="hash-link" href="#attack-scenario" title="Direct link to heading">â€‹</a></h2><ul><li>A GET request to the URL <a href="http://www.example.com/home.php/non-existent.css" target="_blank" rel="noopener noreferrer">http://www.example.com/home.php/non-existent.css</a> is made</li><li>Depending on its technology and configuration (the URL structure might need to be built slightly different for different servers), the server returns the content of <a href="http://www.example.com/home.php" target="_blank" rel="noopener noreferrer">http://www.example.com/home.php</a>.</li><li>The URL remains <a href="http://www.example.com/home.php/non-existent.css" target="_blank" rel="noopener noreferrer">http://www.example.com/home.php/non-existent.css</a></li><li>The HTTP headers will be the same as for accessing <a href="http://www.example.com/home.php" target="_blank" rel="noopener noreferrer">http://www.example.com/home.php</a> directly: same caching headers and same content type (text/html, in this case)</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="detailed">Detailed<a aria-hidden="true" class="hash-link" href="#detailed" title="Direct link to heading">â€‹</a></h3><ol><li>Browser requests <a href="http://www.example.com/home.php/non-existent.css" target="_blank" rel="noopener noreferrer">http://www.example.com/home.php/non-existent.css</a>.</li><li>Server returns the content of <a href="http://www.example.com/home.php" target="_blank" rel="noopener noreferrer">http://www.example.com/home.php</a>, most probably with HTTP caching headers that instruct to not cache this page.</li><li>The response goes through the proxy.</li><li>The proxy identifies that the file has a css extension.</li><li>Under the cache directory, the proxy creates a directory named home.php, and caches the imposter &quot;CSS&quot; file (non-existent.css) inside.</li><li>When next time a user requests non-existent.css file, reverse proxy will not send that request to the web server, instead, it will serve the user with the data that it had stored in its cache. Thus, the request for static data is not reaching the web server again.</li></ol><h2 class="anchor anchorWithStickyNavbar_y2LR" id="exploit-scenario">Exploit Scenario<a aria-hidden="true" class="hash-link" href="#exploit-scenario" title="Direct link to heading">â€‹</a></h2><ul><li>An attacker who lures a logged-on user to access <a href="http://www.example.com/home.php/logo.png" target="_blank" rel="noopener noreferrer">http://www.example.com/home.php/logo.png</a> will cause this page â€“ containing the user&#x27;s personal content â€“ to be cached and thus publicly-accessible.</li><li>It could get even worse, if the body of the response contains (for some reason) the session identifier, security answers or CSRF tokens.</li><li>All the attacker has to do now is to access this page on his own and expose this data.</li></ul><p><img src="https://1.bp.blogspot.com/-zDck8_k-E4Y/WLP6c7VCu-I/AAAAAAAAGcI/lHhHh8SgO5cEVQ3iRBCAVPvdd3Fe-YB8ACLcB/s640/Web_Cache_Manipulation.png" alt="Exploit Flow"></p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="impact">Impact<a aria-hidden="true" class="hash-link" href="#impact" title="Direct link to heading">â€‹</a></h2><p>Video Reference: <a href="https://vimeo.com/249130093" target="_blank" rel="noopener noreferrer">https://vimeo.com/249130093</a></p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="conditions-to-check-web-cache-deception-attack">Conditions to check Web Cache Deception Attack<a aria-hidden="true" class="hash-link" href="#conditions-to-check-web-cache-deception-attack" title="Direct link to heading">â€‹</a></h2><ol><li>The victim must be authenticated while accessing the malicious URL</li><li>Web cache functionality is set for the web application to cache files by their extensions, disregarding any caching header.</li><li>When accessing a page like <a href="http://www.example.com/home.php/non-existent.css" target="_blank" rel="noopener noreferrer">http://www.example.com/home.php/non-existent.css</a>, the web server will return the content of &quot;home.php&quot; for that URL.</li></ol><h2 class="anchor anchorWithStickyNavbar_y2LR" id="mitigation">Mitigation<a aria-hidden="true" class="hash-link" href="#mitigation" title="Direct link to heading">â€‹</a></h2><ol><li>Configure the cache mechanism to cache files only if their HTTP caching headers allow. That will solve the root cause of this issue.</li><li>Store all static files in a designated directory and cache only that directory.</li><li>If the cache component provides the option, configure it to cache files by their content type.</li><li>Configure the web server so that for pages such as <a href="http://www.example.com/home.php/non-existent.css" target="_blank" rel="noopener noreferrer">http://www.example.com/home.php/non-existent.css</a>, the web server doesnâ€™t return the content of &quot;home.php&quot; with this URL. Instead, for example, the server should respond with a 404 or 302 response.</li></ol><h2 class="anchor anchorWithStickyNavbar_y2LR" id="misc-resources">Misc. Resources<a aria-hidden="true" class="hash-link" href="#misc-resources" title="Direct link to heading">â€‹</a></h2><ul><li><a href="https://www.blackhat.com/docs/us-17/wednesday/us-17-Gil-Web-Cache-Deception-Attack-wp.pdf" target="_blank" rel="noopener noreferrer">https://www.blackhat.com/docs/us-17/wednesday/us-17-Gil-Web-Cache-Deception-Attack-wp.pdf</a></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/null-open-security-community/study-group-web-security/docs/web-cache-deception-attack/notes.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2021-11-06T04:36:00.000Z">11/6/2021</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/study-group-web-security/docs/file-upload/resources"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->File Upload Vuln - Resources</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/study-group-web-security/docs/xxe/notes"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Notes<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#normal-scenario" class="table-of-contents__link toc-highlight">Normal Scenario</a></li><li><a href="#attack-scenario" class="table-of-contents__link toc-highlight">Attack Scenario</a><ul><li><a href="#detailed" class="table-of-contents__link toc-highlight">Detailed</a></li></ul></li><li><a href="#exploit-scenario" class="table-of-contents__link toc-highlight">Exploit Scenario</a></li><li><a href="#impact" class="table-of-contents__link toc-highlight">Impact</a></li><li><a href="#conditions-to-check-web-cache-deception-attack" class="table-of-contents__link toc-highlight">Conditions to check Web Cache Deception Attack</a></li><li><a href="#mitigation" class="table-of-contents__link toc-highlight">Mitigation</a></li><li><a href="#misc-resources" class="table-of-contents__link toc-highlight">Misc. Resources</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/study-group-web-security/docs/intro">Documentation</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/null0x00" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://discord.gg/bhwDVGC9Du" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.linkedin.com/company/null-the-open-security-community" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://null.community" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Website<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/null-open-security-community" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 null Web Security Study Group. Built with Docusaurus.</div></div></div></footer></div>
<script src="/study-group-web-security/assets/js/runtime~main.176889d2.js"></script>
<script src="/study-group-web-security/assets/js/main.866a597b.js"></script>
</body>
</html>