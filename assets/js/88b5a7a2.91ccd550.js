"use strict";(self.webpackChunknull_sg_web=self.webpackChunknull_sg_web||[]).push([[607],{3905:function(e,t,a){a.d(t,{Zo:function(){return p},kt:function(){return d}});var n=a(7294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function c(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var s=n.createContext({}),l=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},p=function(e){var t=l(e.components);return n.createElement(s.Provider,{value:t},e.children)},h={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,p=c(e,["components","mdxType","originalType","parentName"]),m=l(a),d=o,u=m["".concat(s,".").concat(d)]||m[d]||h[d]||i;return a?n.createElement(u,r(r({ref:t},p),{},{components:a})):n.createElement(u,r({ref:t},p))}));function d(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=a.length,r=new Array(i);r[0]=m;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:o,r[1]=c;for(var l=2;l<i;l++)r[l]=a[l];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},4892:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return c},contentTitle:function(){return s},metadata:function(){return l},toc:function(){return p},default:function(){return m}});var n=a(7462),o=a(3366),i=(a(7294),a(3905)),r=["components"],c={sidebar_position:1},s="Notes",l={unversionedId:"web-cache-deception-attack/notes",id:"web-cache-deception-attack/notes",isDocsHomePage:!1,title:"Notes",description:"By Muffaddal Masalawala",source:"@site/docs/web-cache-deception-attack/notes.md",sourceDirName:"web-cache-deception-attack",slug:"/web-cache-deception-attack/notes",permalink:"/study-group-web-security/docs/web-cache-deception-attack/notes",editUrl:"https://github.com/null-open-security-community/study-group-web-security/docs/web-cache-deception-attack/notes.md",tags:[],version:"current",lastUpdatedAt:1636173360,formattedLastUpdatedAt:"11/6/2021",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Notes",permalink:"/study-group-web-security/docs/csrf/notes"},next:{title:"Notes",permalink:"/study-group-web-security/docs/xxe/notes"}},p=[{value:"Normal Scenario",id:"normal-scenario",children:[],level:2},{value:"Attack Scenario",id:"attack-scenario",children:[{value:"Detailed",id:"detailed",children:[],level:3}],level:2},{value:"Exploit Scenario",id:"exploit-scenario",children:[],level:2},{value:"Impact",id:"impact",children:[],level:2},{value:"Conditions to check Web Cache Deception Attack",id:"conditions-to-check-web-cache-deception-attack",children:[],level:2},{value:"Mitigation",id:"mitigation",children:[],level:2},{value:"Misc. Resources",id:"misc-resources",children:[],level:2}],h={toc:p};function m(e){var t=e.components,a=(0,o.Z)(e,r);return(0,i.kt)("wrapper",(0,n.Z)({},h,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"notes"},"Notes"),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"By Muffaddal Masalawala")),(0,i.kt)("h2",{id:"normal-scenario"},"Normal Scenario"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Website ",(0,i.kt)("a",{parentName:"li",href:"http://www.example.com"},"http://www.example.com")," is configured to go through a reverse proxy."),(0,i.kt)("li",{parentName:"ul"},"A dynamic page (after authentication) that is stored on the server and returns personal content of users, such as ",(0,i.kt)("a",{parentName:"li",href:"http://www.example.com/home.php"},"http://www.example.com/home.php"),", will have to create it dynamically per user, since the data is different for each user. This kind of data, or at least its personalized parts, isn't cached."),(0,i.kt)("li",{parentName:"ul"},"What's more reasonable and common to cache are static, public files: style sheets (css), scripts (js), text files (txt), images (png, bmp, gif), etc as these files usually don't contain any sensitive information.")),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://miro.medium.com/max/625/0*YVcUk4-Qv7lb06L1.jpg",alt:"Reverse Proxy Working"})),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("ul",{parentName:"div"},(0,i.kt)("li",{parentName:"ul"},"All static files that are meant to be public, are cached disregarding their HTTP caching headers."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Various static file extensions could be used to cache pages"),": aif, aiff, au, avi, bin, bmp, cab, carb, cct, cdf, class, css, doc, dcr, dtd, gcf, gff, gif, grv, hdml, hqx, ico, ini, jpeg, jpg, js, mov, mp3, nc, pct, ppc, pws, swa, swf, txt, vbs, w32, wav, wbmp, wml, wmlc, wmls, wmlsc, xsd, zip")))),(0,i.kt)("h2",{id:"attack-scenario"},"Attack Scenario"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"A GET request to the URL ",(0,i.kt)("a",{parentName:"li",href:"http://www.example.com/home.php/non-existent.css"},"http://www.example.com/home.php/non-existent.css")," is made"),(0,i.kt)("li",{parentName:"ul"},"Depending on its technology and configuration (the URL structure might need to be built slightly different for different servers), the server returns the content of ",(0,i.kt)("a",{parentName:"li",href:"http://www.example.com/home.php"},"http://www.example.com/home.php"),"."),(0,i.kt)("li",{parentName:"ul"},"The URL remains ",(0,i.kt)("a",{parentName:"li",href:"http://www.example.com/home.php/non-existent.css"},"http://www.example.com/home.php/non-existent.css")),(0,i.kt)("li",{parentName:"ul"},"The HTTP headers will be the same as for accessing ",(0,i.kt)("a",{parentName:"li",href:"http://www.example.com/home.php"},"http://www.example.com/home.php")," directly: same caching headers and same content type (text/html, in this case)")),(0,i.kt)("h3",{id:"detailed"},"Detailed"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Browser requests ",(0,i.kt)("a",{parentName:"li",href:"http://www.example.com/home.php/non-existent.css"},"http://www.example.com/home.php/non-existent.css"),"."),(0,i.kt)("li",{parentName:"ol"},"Server returns the content of ",(0,i.kt)("a",{parentName:"li",href:"http://www.example.com/home.php"},"http://www.example.com/home.php"),", most probably with HTTP caching headers that instruct to not cache this page."),(0,i.kt)("li",{parentName:"ol"},"The response goes through the proxy."),(0,i.kt)("li",{parentName:"ol"},"The proxy identifies that the file has a css extension."),(0,i.kt)("li",{parentName:"ol"},'Under the cache directory, the proxy creates a directory named home.php, and caches the imposter "CSS" file (non-existent.css) inside.'),(0,i.kt)("li",{parentName:"ol"},"When next time a user requests non-existent.css file, reverse proxy will not send that request to the web server, instead, it will serve the user with the data that it had stored in its cache. Thus, the request for static data is not reaching the web server again.")),(0,i.kt)("h2",{id:"exploit-scenario"},"Exploit Scenario"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"An attacker who lures a logged-on user to access ",(0,i.kt)("a",{parentName:"li",href:"http://www.example.com/home.php/logo.png"},"http://www.example.com/home.php/logo.png")," will cause this page \u2013 containing the user's personal content \u2013 to be cached and thus publicly-accessible."),(0,i.kt)("li",{parentName:"ul"},"It could get even worse, if the body of the response contains (for some reason) the session identifier, security answers or CSRF tokens."),(0,i.kt)("li",{parentName:"ul"},"All the attacker has to do now is to access this page on his own and expose this data.")),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://1.bp.blogspot.com/-zDck8_k-E4Y/WLP6c7VCu-I/AAAAAAAAGcI/lHhHh8SgO5cEVQ3iRBCAVPvdd3Fe-YB8ACLcB/s640/Web_Cache_Manipulation.png",alt:"Exploit Flow"})),(0,i.kt)("h2",{id:"impact"},"Impact"),(0,i.kt)("p",null,"Video Reference: ",(0,i.kt)("a",{parentName:"p",href:"https://vimeo.com/249130093"},"https://vimeo.com/249130093")),(0,i.kt)("h2",{id:"conditions-to-check-web-cache-deception-attack"},"Conditions to check Web Cache Deception Attack"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"The victim must be authenticated while accessing the malicious URL"),(0,i.kt)("li",{parentName:"ol"},"Web cache functionality is set for the web application to cache files by their extensions, disregarding any caching header."),(0,i.kt)("li",{parentName:"ol"},"When accessing a page like ",(0,i.kt)("a",{parentName:"li",href:"http://www.example.com/home.php/non-existent.css"},"http://www.example.com/home.php/non-existent.css"),', the web server will return the content of "home.php" for that URL.')),(0,i.kt)("h2",{id:"mitigation"},"Mitigation"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Configure the cache mechanism to cache files only if their HTTP caching headers allow. That will solve the root cause of this issue."),(0,i.kt)("li",{parentName:"ol"},"Store all static files in a designated directory and cache only that directory."),(0,i.kt)("li",{parentName:"ol"},"If the cache component provides the option, configure it to cache files by their content type."),(0,i.kt)("li",{parentName:"ol"},"Configure the web server so that for pages such as ",(0,i.kt)("a",{parentName:"li",href:"http://www.example.com/home.php/non-existent.css"},"http://www.example.com/home.php/non-existent.css"),', the web server doesn\u2019t return the content of "home.php" with this URL. Instead, for example, the server should respond with a 404 or 302 response.')),(0,i.kt)("h2",{id:"misc-resources"},"Misc. Resources"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.blackhat.com/docs/us-17/wednesday/us-17-Gil-Web-Cache-Deception-Attack-wp.pdf"},"https://www.blackhat.com/docs/us-17/wednesday/us-17-Gil-Web-Cache-Deception-Attack-wp.pdf"))))}m.isMDXComponent=!0}}]);